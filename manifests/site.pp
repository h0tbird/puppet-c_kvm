#------------------------------------------------------------------------------
# Stages:
#------------------------------------------------------------------------------

stage { 'pre':  before  => Stage['main'] }
stage { 'post': require => Stage['main'] }

#------------------------------------------------------------------------------
# Enable the Puppet 4 behavior today:
#------------------------------------------------------------------------------

Package { allow_virtual => true }

#------------------------------------------------------------------------------
# Do not mess with services in a docker build:
#------------------------------------------------------------------------------

if $::docker_build {
  Service <||> {
    hasrestart => true,
    hasstatus  => true,
    restart    => '/bin/true',
    stop       => '/bin/true',
    start      => '/bin/true',
    status     => '/bin/true',
  }
}

#------------------------------------------------------------------------------
# Node classifier:
#------------------------------------------------------------------------------

node /^([a-z]+)\d{2}/ { include "::r_${1}" }
